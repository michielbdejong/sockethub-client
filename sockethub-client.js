define("sockethub/extend",[],function(){function e(t){var n=Array.prototype.slice.call(arguments,1);return n.forEach(function(n){for(var r in n)typeof n[r]=="object"&&typeof t[r]=="object"?e(t[r],n[r]):t[r]=n[r]}),t}return e}),function(){function e(t){function o(e){if(i){var t;if(e.fulfilled)try{t=[e.fulfilled.apply(null,s)]}catch(n){e.promise.reject(n);return}else t=s;t[0]&&typeof t[0].then=="function"?t[0].then(e.promise.fulfill,e.promise.reject):e.promise.fulfill.apply(null,t)}else if(e.rejected){var r;try{r=e.rejected.apply(null,s)}catch(n){e.promise.reject(n);return}r&&typeof r.then=="function"?r.then(e.promise.fulfill,e.promise.reject):e.promise.fulfill(r)}else e.promise.reject.apply(null,s)}function u(e,t){if(s){console.log("WARNING: Can't resolve promise, already resolved!");return}i=e,s=Array.prototype.slice.call(t),setTimeout(function(){var e=r.length;e===0&&!i;for(var t=0;t<e;t++)o(r[t]);r=undefined},0)}var n;typeof t=="function"&&setTimeout(function(){try{t(n)}catch(e){n.reject(e)}},0);var r=[],i,s;return n={then:function(t,n){var i={fulfilled:typeof t=="function"?t:undefined,rejected:typeof n=="function"?n:undefined,promise:e()};return s?setTimeout(function(){o(i)},0):r.push(i),i.promise},fulfill:function(){return u(!0,arguments),this},reject:function(){return u(!1,arguments),this}},n}typeof module!="undefined"?module.exports=e:typeof define=="function"?define("vendor/promising",[],function(){return e}):typeof window!="undefined"&&(window.promising=e)}(),define("sockethub/event_handling",[],function(){var e={on:function(e,t){this._validateEvent(e),this._handlers[e].push(t)},_emit:function(e){this._validateEvent(e);var t=Array.prototype.slice.call(arguments,1);this._handlers[e].forEach(function(e){e.apply(this,t)})},_validateEvent:function(e){if(!(e in this._handlers))throw"Unknown event: "+e},_delegateEvent:function(e,t){t.on(e,function(t){this._emit(e,t)}.bind(this))},_addEvent:function(e){this._handlers[e]=[]}};return function(t){var n=Array.prototype.slice.call(arguments,1);for(var r in e)t[r]=e[r];t._handlers={},n.forEach(function(e){t._addEvent(e)})}}),define("sockethub/client",["./extend","../vendor/promising","./event_handling"],function(e,t,n){var r=function(e,t){this.jsonClient=e,this.options=t,this._ridPromises={},n(this,"connected","disconnected","failed"),e.on("message",this._processIncoming.bind(this)),this._delegateEvent("connected",e),this._delegateEvent("disconnected",e),this._delegateEvent("failed",e)};return r.prototype={declareVerb:function(t,n,r,i){this[t]=function(){var i=Array.prototype.slice.call(arguments),s=e({},r,{verb:t});n.forEach(function(e,t){var n=i[t],r=this._getDeepAttr(s,e);if(typeof r=="undefined"&&typeof n=="undefined")throw new Error("Expected a value for parameter "+e+", but got undefined!");this._setDeepAttr(s,e,n)}.bind(this));var o=i[n.length];return typeof o=="object"&&e(s,o),this.sendObject(s)},i&&(this[t]=i(this[t].bind(this)))},declareEvent:function(e){this._addEvent(e)},disconnect:function(){this.jsonClient.disconnect()},_ridCounter:0,sendObject:function(n){var r=t(),i=++this._ridCounter;return this._ridPromises[i]=r,n=e(n,{rid:i}),console.log("SEND",n),this.jsonClient.send(n),r},_getDeepAttr:function(e,t,n){var r=n||t.split("."),i=e[r.shift()];return r.length?this._getDeepAttr(i,undefined,r):i},_setDeepAttr:function(e,t,n,r){var i=r||t.split(".");i.length>1?this._setDeepAttr(e[i.shift()],undefined,n,i):e[i[0]]=n},_processIncoming:function(e){console.log(e.verb==="confirm"?"CONFIRM":"RECEIVE",e);var t=e.rid;if(typeof t!="undefined"){var n=this._ridPromises[t];if(n){if(e.verb==="confirm"){if(e.status)return;n.reject(e)}else n.fulfill(e);delete this._ridPromises[t]}}}},r}),define("sockethub/json_client",["./event_handling"],function(e){var t=function(t){this.socket=t,e(this,"message","connected","disconnected","failed"),this._listen()};return t.prototype={send:function(e){this.socket.send(JSON.stringify(e))},disconnect:function(){this.socket.close()},_listen:function(){this.socket.onmessage=this._processMessageEvent.bind(this),this.connected=!1,this.socket.onopen=function(){this.connected=!0,this._emit("connected")}.bind(this),this.socket.onclose=function(){this.connected?(this._emit("disconnected"),this.connected=!1):this._emit("failed")}.bind(this)},_processMessageEvent:function(e){this._emit("message",JSON.parse(e.data))}},t}),define("sockethub/connect",["./extend","./json_client","./client"],function(e,t,n){var r=10550,i="/sockethub",s="sockethub",o=function(o,u){var a;typeof u!="object"&&(u={}),typeof o=="string"&&!o.match(/wss?\:\/\//)&&(o={host:o});if(typeof o=="string")a=o;else{if(typeof o!="object")throw"SockethubClient.connect expects a URI, specified via a String or Object.";e(u,o);if(!u.host)throw"Required 'host' option not present";u.port||(u.port=r),u.path||(u.path=i),a=(u.ssl?"wss":"ws")+"://"+u.host+":"+u.port+u.path}return new n(new t(new WebSocket(a,s)),u)};return o}),define("verbs/core",[],function(){var e=function(e){e.declareVerb("ping",[],{platform:"dispatcher"},function(e){return function(t){return typeof t!="object"&&(t={}),typeof t.timestamp!="number"&&(t.timestamp=(new Date).getTime()),e(t).then(function(e){return e.offset=(new Date).getTime()-t.timestamp,e})}}),e.declareVerb("register",["object"],{platform:"dispatcher"},function(t){return function(){return t.apply(this,arguments).then(function(t){if(!t.status)throw e._emit("registration-failed",t),"Registration failed: "+t.message;return e._emit("registered"),t})}}),e.declareEvent("registered"),e.declareEvent("registration-failed"),e.on("connected",function(){console.log("automatic registration!",e.options),e.options.register&&(console.log("automatic registration!"),e.register(e.options.register))}),e.declareVerb("set",["target.platform","object"],{platform:"dispatcher",target:{}})};return e}),define("sockethub-client",["sockethub/client","sockethub/connect","verbs/core"],function(e,t,n){return e.connect=function(){var e=t.apply(this,arguments);return n(e),e},e});